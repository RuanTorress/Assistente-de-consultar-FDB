# (Substitua por Nome do Projeto) ‚Äì Assistente Inteligente para Consultas em Firebird (.FDB)

> Gere SQL a partir de linguagem natural, diagnostique conex√µes Firebird, teste m√∫ltiplos drivers, use fallback entre modelos (OpenAI / Gemini / Offline) e explore seu banco de forma interativa.

---

## üìå Vis√£o Geral

Este projeto re√∫ne v√°rios scripts Python que:
- Conectam (ou tentam conectar) a bancos Firebird (`.FDB`)
- Geram consultas SQL a partir de perguntas em linguagem natural (PT-BR)
- Alternam dinamicamente entre modelos (OpenAI / Gemini) com fallback offline
- Fazem diagn√≥stico de ambiente e drivers
- Oferecem modos simplificado, h√≠brido, multi-driver, demo (SQLite) e offline

Voc√™ pode us√°-lo como:
- Ferramenta de explora√ß√£o interativa
- Base para um pacote Python
- Assistente interno (‚Äúcopilot‚Äù) para Firebird
- Ferramenta de treinamento e demonstra√ß√£o

---

## ‚ú® Principais Recursos

| Recurso | Script Principal | Descri√ß√£o |
|---------|------------------|-----------|
| Chat + Gera√ß√£o de SQL (Firebird real) | `main_central.py`, `main_hibrido.py` | Conversa e executa SQL diretamente no banco |
| Multi-driver (fdb / firebirdsql / firebird.driver) | `main_multi_driver.py` | Tenta diferentes drivers automaticamente |
| Diagn√≥stico de conex√£o | `diagnostico_firebird.py` | Testa v√°rias configura√ß√µes e relata falhas |
| Gera√ß√£o sem conex√£o | `main_sql_generator.py`, `main_simples.py` | Produz apenas SQL para execu√ß√£o manual |
| Modo h√≠brido OpenAI ‚Üî Gemini | `main_hibrido.py`, `main_central.py` | Troca de provedor e fallback |
| Duas chaves OpenAI | `main_dupla_api.py` | Rota√ß√£o entre duas contas/chaves |
| Demo com SQLite (simula√ß√£o) | `main_demo.py` | Simula um ambiente para demonstra√ß√£o |
| Modo totalmente offline | `main_offline.py` | Responde com SQL pr√©-mapeada sem IA |
| Dicion√°rio offline inteligente | V√°rios scripts | Palavras‚Äëchave ‚Üí consultas √∫teis |

---

## üß± Estrutura Atual (Sugest√£o de Organiza√ß√£o Futuras)

```
.
‚îú‚îÄ‚îÄ diagnostico_firebird.py
‚îú‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ main_central.py
‚îú‚îÄ‚îÄ main_demo.py
‚îú‚îÄ‚îÄ main_dupla_api.py
‚îú‚îÄ‚îÄ main_hibrido.py
‚îú‚îÄ‚îÄ main_multi_driver.py
‚îú‚îÄ‚îÄ main_offline.py
‚îú‚îÄ‚îÄ main_simples.py
‚îú‚îÄ‚îÄ main_sql_generator.py
‚îú‚îÄ‚îÄ Redmir.md          (arquivo antigo - pode remover ou substituir)
‚îî‚îÄ‚îÄ README.md          (este arquivo)
```

Sugerido para evolu√ß√£o (pacote):
```
seu_projeto/
  core/
    connection.py
    drivers.py
    diagnostics.py
  ai/
    openai_provider.py
    gemini_provider.py
    offline_fallback.py
  cli/
    chat.py
    generate.py
    offline.py
    demo.py
  prompts/
    firebird_rules.txt
  utils/
    normalize.py
    env.py
```

---

## ‚úÖ Pr√©-Requisitos

- Python 3.10+ (recomendado)
- Firebird instalado (para uso real): https://firebirdsql.org/en/downloads/
- Cliente ou biblioteca (`fbclient.dll` no Windows) acess√≠vel no PATH
- Drivers Python:
  - `fdb`
  - (Opcional) `firebirdsql`, `firebird-driver`
- Contas v√°lidas (se usar IA) para:
  - OpenAI
  - Google Gemini

---

## üì¶ Instala√ß√£o das Depend√™ncias

```bash
python -m venv .venv
# Ativar ambiente:
# Windows PowerShell:
. .venv/Scripts/Activate.ps1
# Linux/Mac:
source .venv/bin/activate

pip install --upgrade pip
pip install fdb
pip install firebirdsql firebird-driver     # (opcionais)
pip install openai
pip install google-generativeai
python -m pip install python-dotenv         # (recomendado para .env)
```

---

## üîê Configura√ß√£o de Vari√°veis de Ambiente

NUNCA armazene chaves reais dentro dos arquivos Python em produ√ß√£o.

Crie um arquivo `.env`:

```
OPENAI_API_KEY=coloque_sua_chave_aqui
GEMINI_API_KEY=coloque_sua_chave_aqui
FIREBIRD_DB_PATH=C:\caminho\para\CENTRAL.FDB
FIREBIRD_HOST=localhost
FIREBIRD_PORT=3050
FIREBIRD_USER=SYSDBA
FIREBIRD_PASSWORD=masterkey
```

Use no c√≥digo:

```python
from dotenv import load_dotenv
import os
load_dotenv()

OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")
```

---

## ‚ö†Ô∏è Seguran√ßa

- Remova todas as chaves hardcoded antes de comitar (est√£o expostas nos scripts).
- Fa√ßa um commit substituindo-as por leitura via `os.getenv`.
- Se as chaves j√° estiverem p√∫blicas, revogue-as nos pain√©is OpenAI / Google.

---

## üöÄ Modos de Uso (Scripts)

### 1. Diagn√≥stico de Conex√£o

```bash
python diagnostico_firebird.py
```
Testa m√∫ltiplas formas de conex√£o (porta 4050/3050, DSN, embedded) e retorna a primeira v√°lida.

### 2. Chat com Execu√ß√£o Real (multi API)

```bash
python main_menu.py
```
Comandos √∫teis no chat:

- `trocar` ‚Üí alterna OpenAI/Gemini
- `sair` ‚Üí finaliza

### 3. Modo H√≠brido Inteligente

```bash
python main_hibrido.py
```
Similar ao central, mas com regras mais contextuais (ex: ‚ÄúTEM TABELA X‚Äù).

### 4. Multi-Driver Auto-Teste

```bash
python main_multi_driver.py
```
Percorre `fdb`, `firebirdsql`, `firebird.driver` e tenta diferentes configs.

### 5. Gerador de SQL (sem conex√£o)

```bash
python main_sql_generator.py
```
Ideal quando o Firebird n√£o est√° dispon√≠vel.

### 6. Duas Chaves OpenAI

```bash
python main_dupla_api.py
```
Rotaciona entre `openai_1` e `openai_2` quando h√° erro de cota.

### 7. Demo com SQLite (para demonstrar sem Firebird)

```bash
python main_demo.py
```
Simula tabela `CLI_CLIENTE` em mem√≥ria.

### 8. Modo Simples

```bash
python main_simples.py
```
Entrada ‚Üí Gera√ß√£o de SQL ‚Üí Sa√≠da (somente).

### 9. Modo Offline Total

```bash
python main_offline.py
```
Mapeia termos para SQL pr√©-definida sem IA.

---

## üîÑ Fluxo de Fallback (IA)

Ordem t√≠pica implementada:
1. Tenta gerar SQL com OpenAI
2. Se quota/erro: muda para Gemini
3. Se falhar novamente: usa dicion√°rio offline
4. Caso o script suporte multi-driver: retorna SQL mesmo sem conex√£o

---

## üß† Regras de Gera√ß√£o de SQL (Resumo)

- Usa `FIRST X` em vez de `LIMIT X` (Firebird)
- Para listar tabelas:  
  `SELECT RDB$RELATION_NAME FROM RDB$RELATIONS WHERE RDB$SYSTEM_FLAG = 0`
- Para campos:  
  `SELECT RDB$FIELD_NAME FROM RDB$RELATION_FIELDS WHERE RDB$RELATION_NAME = 'NOME'`
- Para buscar:  
  `SELECT * FROM TABELA WHERE CAMPO LIKE '%valor%'`
- Normaliza strings retirando espa√ßos de padding
- Oferece consultas contextuais (clientes, procedures, triggers, generators)

---

## üß™ Exemplos de Perguntas

Pergunta:
```
lista as tabelas
```
Resposta (esperada):
```
SELECT RDB$RELATION_NAME
FROM RDB$RELATIONS
WHERE RDB$SYSTEM_FLAG = 0
ORDER BY RDB$RELATION_NAME
```

Pergunta:
```
tem cliente Maria?
```
Resposta:
```
SELECT * FROM CLI_CLIENTE WHERE UPPER(NOME) LIKE '%MARIA%'
```

Pergunta:
```
quantos clientes tem
```
Resposta:
```
SELECT COUNT(*) FROM CLI_CLIENTE
```

---

## üîß Pr√≥ximos Passos (Roadmap Sugerido)

- [ ] Criar pacote instal√°vel (`pyproject.toml`)
- [ ] Unificar prompts em arquivos externos (ex: `prompts/`)
- [ ] Implementar logging estruturado (`logging` + n√≠veis)
- [ ] Adicionar testes unit√°rios (pytest) para dicion√°rio offline
- [ ] Adicionar modo REST (FastAPI)
- [ ] Adicionar cache de respostas (functools.lru_cache ou Redis)
- [ ] Sanitiza√ß√£o de perguntas antes de virar SQL (reduzir risco de injection)
- [ ] Suporte a m√∫ltiplos bancos (Firebird ‚Üí PostgreSQL adapt√°vel)
- [ ] Dockerfile (com fbclient pr√©-instalado)
- [ ] Integra√ß√£o com interface web (Streamlit ou FastAPI + HTMX)

---

## ü§ù Contribuindo

1. Fa√ßa um fork
2. Crie uma branch: `feature/melhorias`
3. Commits descritivos (PT ou EN)  
4. Abra PR explicando o contexto

Sugest√£o de padr√£o de commit:
```
feat(sql): adiciona regra para buscar por email
fix(conn): corrige fallback ao driver firebirdsql
docs(readme): melhora se√ß√£o de instala√ß√£o
```

---

## üìù Licen√ßa

(Escolha uma: MIT / Apache-2.0 / BSD-3 / Propriet√°ria interna).  
Exemplo MIT:

```
MIT License (coloque aqui o texto completo da MIT)
```

---

## ‚ùì FAQ

| Pergunta | Resposta |
|----------|----------|
| Falhou na porta 4050 | Tente 3050 ou verifique servi√ßo do Firebird |
| N√£o lista tabelas | Usu√°rio sem permiss√£o ou banco vazio |
| Acentos estranhos | Defina `charset='UTF8'` na conex√£o |
| Retorna espa√ßos em strings | Campos CHAR fixos ‚Äì use `.strip()` (j√° tratado em alguns scripts) |
| Chave OpenAI inv√°lida | Revogue e gere nova no painel da OpenAI |
| Quero rodar no Linux | Instale o pacote `firebird` e a client library (`libfbclient.so`) |

---

## üßπ Limpeza e Boas Pr√°ticas

- Remova `Redmir.md` (grafia incorreta) e mantenha apenas `README.md`.
- Use `.gitignore` para:  
  ```
  .venv/
  .env
  __pycache__/
  *.log
  ```
- Caso publique, remova caminhos absolutos (ex: `C:\Users\Dev Ruan\...`).

---

## üõü Suporte / D√∫vidas

Abra uma issue ou envie uma pergunta descrevendo:
- Sistema Operacional
- Vers√£o Python
- Script usado
- Stack trace (se houver)

---

## üîÑ Personaliza√ß√£o do Nome

Edite o topo substituindo ‚Äú(Substitua por Nome do Projeto)‚Äù. Exemplos prontos:
- FirebirdLens
- fdbchat
- FireSQL Forge
- QueryBird

Escolha um, substitua e ajuste o slogan.

---

Feito com foco em produtividade e explora√ß√£o inteligente de bancos Firebird.  
Contribua, adapte e evolua!
